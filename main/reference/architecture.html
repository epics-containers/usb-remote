
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Architecture &#8212; usb-remote 2.3.3.dev4+g7cc790b32 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=e083b31a"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=30646c52"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'reference/architecture';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://epics-containers.github.io/usb-remote/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'main';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <link rel="icon" href="../_static/dls-logo.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Connecting to GovWiFi" href="govwifi_setup.html" />
    <link rel="prev" title="Server Socket API" href="server_socket_api.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="main" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/dls-logo.svg" class="logo__image only-light" alt=""/>
    <img src="../_static/dls-logo.svg" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">usb-remote</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../tutorials.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../how-to.html">
    How-to Guides
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../explanations.html">
    Explanations
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../reference.html">
    Reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/epics-containers/usb-remote" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/usb-remote" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-cube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../tutorials.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../how-to.html">
    How-to Guides
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../explanations.html">
    Explanations
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../reference.html">
    Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/epics-containers/usb-remote" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/usb-remote" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-cube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="recommended_hardware.html">Recommend Server Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Client Configuration File</a></li>
<li class="toctree-l1"><a class="reference internal" href="client_service_api.html">Client Service Socket API</a></li>
<li class="toctree-l1"><a class="reference internal" href="server_socket_api.html">Server Socket API</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="govwifi_setup.html">Connecting to GovWiFi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_api/usb_remote.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Index</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/epics-containers/usb-remote/releases">Release Notes</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../reference.html" class="nav-link">Reference</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Architecture</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="architecture">
<h1>Architecture<a class="headerlink" href="#architecture" title="Link to this heading">#</a></h1>
<p>This document explains the architecture and design of usb-remote.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>usb-remote is a client-server system for sharing USB devices over a network using the USB/IP protocol. It provides a high-level Python interface with automatic device discovery across multiple servers.</p>
<p>It intentionally provides no security features, relying on network-level security instead. This makes it very simple to deploy and operate in controlled environments.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>┌─────────────────────────────────────────────────────────────────┐
│                         usb-remote Architecture                 │
└─────────────────────────────────────────────────────────────────┘

┌──────────────┐                                  ┌──────────────┐
│              │         Network (TCP/IP)         │              │
│    Client    │◄────────────────────────────────►│    Server    │
│   Machine    │        Port 5055 (JSON)          │   Machine    │
│              │                                  │              │
└──────────────┘                                  └──────────────┘
      │                                                  │
      │ usbip attach/detach                              │ usbip bind
      │ (USB/IP kernel)                                  │ (USB/IP kernel)
      ▼                                                  ▼
┌──────────────┐                                  ┌──────────────┐
│   Virtual    │         USB/IP Protocol          │   Physical   │
│ USB Devices  │◄────────────────────────────────►│ USB Devices  │
│  (vhci-hcd)  │      Port 3240 (binary)          │   (ehci,     │
│              │                                  │    xhci...)  │
└──────────────┘                                  └──────────────┘
      │                                                   │
      ▼                                                   ▼
  Applications                                    Actual USB Hardware
  using devices                                   (cameras, Arduino, etc.)
</pre></div>
</div>
</section>
<section id="components">
<h2>Components<a class="headerlink" href="#components" title="Link to this heading">#</a></h2>
<section id="client-usb-remote-cli">
<h3>1. Client (usb-remote CLI)<a class="headerlink" href="#client-usb-remote-cli" title="Link to this heading">#</a></h3>
<p>The client provides a user-friendly command-line interface for managing remote USB devices.</p>
<p><strong>Key Modules:</strong></p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">__main__.py</span></code></strong>: CLI entry point using Typer</p>
<ul>
<li><p>Command parsing and validation</p></li>
<li><p>User interaction</p></li>
<li><p>Error handling and display</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">client.py</span></code></strong>: Network communication</p>
<ul>
<li><p>JSON-based protocol over TCP</p></li>
<li><p>Server discovery and querying</p></li>
<li><p>Multi-server support</p></li>
<li><p>Timeout handling</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">config.py</span></code></strong>: Configuration management</p>
<ul>
<li><p>YAML configuration files</p></li>
<li><p>File discovery (env, local, user config)</p></li>
<li><p>Pydantic validation</p></li>
<li><p>Server list management</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">usbdevice.py</span></code></strong>: USB device abstraction</p>
<ul>
<li><p>Device enumeration</p></li>
<li><p>Metadata extraction (vendor, product, serial)</p></li>
<li><p>Device filtering and matching</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">utility.py</span></code></strong>: Helper functions</p>
<ul>
<li><p>Subprocess execution</p></li>
<li><p>Error handling</p></li>
<li><p>Logging utilities</p></li>
</ul>
</li>
</ul>
<p><strong>Client Workflow:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>User Command
     │
     ▼
┌─────────────────┐
│  CLI Parser     │  Parse arguments
│  (Typer)        │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Config Loading  │  Discover &amp; load config
│                 │  Get server list
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Server Query    │  Send JSON request to each server
│                 │  Collect responses
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Device Matching │  Filter devices by criteria
│                 │  Handle multiple matches
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ USB/IP Command  │  Execute usbip attach/detach
│                 │  Verify success
└────────┬────────┘
         │
         ▼
    Display Result
</pre></div>
</div>
</section>
<section id="server-usb-remote-server">
<h3>2. Server (usb-remote server)<a class="headerlink" href="#server-usb-remote-server" title="Link to this heading">#</a></h3>
<p>The server runs on machines with USB devices to share, exposing them via a JSON API.</p>
<p><strong>Key Modules:</strong></p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">server.py</span></code></strong>: TCP server implementation</p>
<ul>
<li><p>Socket handling</p></li>
<li><p>Request/response cycle</p></li>
<li><p>Error responses</p></li>
<li><p>Connection management</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">usbdevice.py</span></code></strong>: Device enumeration (shared with client)</p>
<ul>
<li><p>Queries local USB devices via <code class="docutils literal notranslate"><span class="pre">usbip</span> <span class="pre">list</span> <span class="pre">-l</span></code></p></li>
<li><p>Extracts device metadata</p></li>
<li><p>Manages USB/IP binding</p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">service.py</span></code></strong>: Systemd integration</p>
<ul>
<li><p>Service file generation</p></li>
<li><p>Installation/uninstallation</p></li>
<li><p>User vs. system service support</p></li>
</ul>
</li>
</ul>
<p><strong>Server Workflow:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Server Start
     │
     ▼
┌─────────────────┐
│  Bind Socket    │  Listen on 0.0.0.0:5055
│                 │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Accept         │◄─── Wait for connections
│  Connection     │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Receive        │  Read JSON request
│  Request        │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Parse &amp;        │  Validate using Pydantic
│  Validate       │
└────────┬────────┘
         │
         ├──────► list: Query local devices
         │              Return device list
         │
         ├──────► attach: Find device
         │                Return device details
         │
         ├──────► detach: Find device
         │                Return device details
         │
         ▼
┌─────────────────┐
│  Send Response  │  JSON response
│                 │
└────────┬────────┘
         │
         ▼
   Close Connection
         │
         └──────► Wait for next connection
</pre></div>
</div>
</section>
<section id="protocol-pydantic-models">
<h3>3. Protocol (Pydantic Models)<a class="headerlink" href="#protocol-pydantic-models" title="Link to this heading">#</a></h3>
<p>Communication uses JSON messages validated by Pydantic models.</p>
<p>See <a class="reference download internal" download="" href="../_downloads/a237276fe5c036e656e601d72ffac629/api.py"><span class="xref download myst">api.py</span></a> for full details.</p>
</section>
<section id="usb-ip-layer">
<h3>4. USB/IP Layer<a class="headerlink" href="#usb-ip-layer" title="Link to this heading">#</a></h3>
<p>usb-remote leverages the Linux USB/IP kernel driver for actual device sharing.</p>
<p><strong>USB/IP Components:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Client Side:
┌──────────────────────┐
│  vhci-hcd module     │  Virtual USB host controller
│                      │  Presents remote devices as local
└──────────────────────┘

Server Side:
┌──────────────────────┐
│  usbip-host module   │  Exports USB devices
│                      │  Binds physical devices to network
└──────────────────────┘

Protocol:
┌──────────────────────┐
│  USB/IP Protocol     │  Binary protocol on port 3240
│  (TCP, port 3240)    │  Tunnels USB traffic over network
└──────────────────────┘
</pre></div>
</div>
<p><strong>How usb-remote Uses USB/IP:</strong></p>
<ol class="arabic simple">
<li><p><strong>Server side:</strong></p>
<ul class="simple">
<li><p>Lists devices: <code class="docutils literal notranslate"><span class="pre">usbip</span> <span class="pre">list</span> <span class="pre">-lp</span></code></p></li>
<li><p>Binds device: <code class="docutils literal notranslate"><span class="pre">usbip</span> <span class="pre">bind</span> <span class="pre">-b</span> <span class="pre">&lt;bus_id&gt;</span></code></p></li>
<li><p>Unbinds device: <code class="docutils literal notranslate"><span class="pre">usbip</span> <span class="pre">unbind</span> <span class="pre">-b</span> <span class="pre">&lt;bus_id&gt;</span></code></p></li>
</ul>
</li>
<li><p><strong>Client side:</strong></p>
<ul class="simple">
<li><p>Attaches device: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">usbip</span> <span class="pre">attach</span> <span class="pre">-r</span> <span class="pre">&lt;server&gt;</span> <span class="pre">-b</span> <span class="pre">&lt;bus_id&gt;</span></code></p></li>
<li><p>Detaches device: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">usbip</span> <span class="pre">detach</span> <span class="pre">-p</span> <span class="pre">&lt;port&gt;</span></code></p></li>
<li><p>Lists attached: <code class="docutils literal notranslate"><span class="pre">usbip</span> <span class="pre">port</span></code></p></li>
</ul>
</li>
</ol>
</section>
</section>
<section id="configuration-system">
<h2>Configuration System<a class="headerlink" href="#configuration-system" title="Link to this heading">#</a></h2>
<section id="discovery-priority">
<h3>Discovery Priority<a class="headerlink" href="#discovery-priority" title="Link to this heading">#</a></h3>
<ol class="arabic simple" start="2">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">usb-remote_CONFIG</span></code> env var</strong>: Environment override</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">.usb-remote.config</span></code></strong>: Project-local config</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">~/.config/usb-remote/usb-remote.config</span></code></strong>: User default</p></li>
</ol>
</section>
<section id="configuration-model">
<h3>Configuration Model<a class="headerlink" href="#configuration-model" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">usb</span><span class="o">-</span><span class="n">remoteConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">servers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Validated using Pydantic for type safety and constraints.</p>
</section>
</section>
<section id="multi-server-support">
<h2>Multi-Server Support<a class="headerlink" href="#multi-server-support" title="Link to this heading">#</a></h2>
<section id="list-command">
<h3>List Command<a class="headerlink" href="#list-command" title="Link to this heading">#</a></h3>
<p>Query all configured servers in parallel:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>┌────────┐    ┌────────┐    ┌────────┐
│Server 1│    │Server 2│    │Server 3│
└───┬────┘    └───┬────┘    └───┬────┘
    │             │             │
    ◄─────────────┼─────────────┤ Client queries all
    │             │             │
    ├─────────────►             │
    │  Response   │             │
    │             ├─────────────►
    │             │  Response   │
    │             │             ├────────►
    │             │             │ Response
    │             │             │
    └─────────────┴─────────────┴────────────►
                                   Aggregate results
</pre></div>
</div>
</section>
<section id="attach-command">
<h3>Attach Command<a class="headerlink" href="#attach-command" title="Link to this heading">#</a></h3>
<p>Search servers sequentially until match found:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>┌────────┐    ┌────────┐    ┌────────┐
│Server 1│    │Server 2│    │Server 3│
└───┬────┘    └───┬────┘    └───┬────┘
    │             │             │
    ◄─────────────┤             │ Query Server 1
    │  No match   │             │
    │             ◄─────────────┤ Query Server 2
    │             │   Match!    │ Found - stop searching
    │             ├─────────────►
    │             │             │
    │             │             │
    └─────────────┴─────────────┘
              Attach from Server 2
</pre></div>
</div>
</section>
</section>
<section id="error-handling">
<h2>Error Handling<a class="headerlink" href="#error-handling" title="Link to this heading">#</a></h2>
<section id="layers-of-error-handling">
<h3>Layers of Error Handling<a class="headerlink" href="#layers-of-error-handling" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><strong>Network Layer</strong>: Connection timeouts, refused connections</p></li>
<li><p><strong>Protocol Layer</strong>: Invalid JSON, schema validation</p></li>
<li><p><strong>Application Layer</strong>: Device not found, multiple matches</p></li>
<li><p><strong>System Layer</strong>: USB/IP command failures</p></li>
</ol>
</section>
<section id="error-flow">
<h3>Error Flow<a class="headerlink" href="#error-flow" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>User Command
     │
     ▼
  Try Query
     │
     ├──► Network Error ──► Log warning, try next server
     │
     ├──► Timeout ──► Log warning, try next server
     │
     ├──► Server Error ──► Log error details
     │
     └──► Success ──► Process response
          │
          ├──► No match ──► Try next server
          │
          ├──► Multiple matches ──► Error (unless --first)
          │
          └──► Single match ──► Proceed
</pre></div>
</div>
</section>
</section>
<section id="security-considerations">
<h2>Security Considerations<a class="headerlink" href="#security-considerations" title="Link to this heading">#</a></h2>
<p>This project is a software replacement for AnywhereUSB, which is a commercial product designed for USB over IP sharing. It explicitly does not provide the  security features of the commercial product. This is to make it easy to deploy and operate in a controlled network environment where security can be managed at the network level.</p>
<p><strong>Key Points:</strong></p>
<ul class="simple">
<li><p>No authentication in base protocol (network security required)</p></li>
<li><p>Requires root/sudo for USB/IP operations</p></li>
<li><p>No encryption (use VPN for remote access)</p></li>
</ul>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="server_socket_api.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Server Socket API</p>
      </div>
    </a>
    <a class="right-next"
       href="govwifi_setup.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Connecting to GovWiFi</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#components">Components</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#client-usb-remote-cli">1. Client (usb-remote CLI)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#server-usb-remote-server">2. Server (usb-remote server)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#protocol-pydantic-models">3. Protocol (Pydantic Models)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#usb-ip-layer">4. USB/IP Layer</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-system">Configuration System</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#discovery-priority">Discovery Priority</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-model">Configuration Model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-server-support">Multi-Server Support</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#list-command">List Command</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#attach-command">Attach Command</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#error-handling">Error Handling</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#layers-of-error-handling">Layers of Error Handling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#error-flow">Error Flow</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#security-considerations">Security Considerations</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/epics-containers/usb-remote/edit/main/docs/reference/architecture.md">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/reference/architecture.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>